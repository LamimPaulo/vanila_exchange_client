!function(e){"use strict";e.browser||(e.browser={},e.browser.mozilla=/mozilla/.test(navigator.userAgent.toLowerCase())&&!/webkit/.test(navigator.userAgent.toLowerCase()),e.browser.webkit=/webkit/.test(navigator.userAgent.toLowerCase()),e.browser.opera=/opera/.test(navigator.userAgent.toLowerCase()),e.browser.msie=/msie/.test(navigator.userAgent.toLowerCase()));var t={destroy:function(){return e(this).unbind(".maskMoney"),e.browser.msie&&(this.onpaste=null),this},mask:function(t){return this.each(function(){var n,a=e(this);return"number"==typeof t&&(a.trigger("mask"),n=e(a.val().split(/\D/)).last()[0].length,t=t.toFixed(n),a.val(t)),a.trigger("mask")})},unmasked:function(){return this.map(function(){var t,n=e(this).val()||"0",a=-1!==n.indexOf("-");return e(n.split(/\D/).reverse()).each(function(e,n){return n?(t=n,!1):void 0}),n=(n=n.replace(/\D/g,"")).replace(new RegExp(t+"$"),"."+t),a&&(n="-"+n),parseFloat(n)})},init:function(t){return t=e.extend({prefix:"",suffix:"",affixesStay:!0,thousands:",",decimal:".",precision:2,allowZero:!1,allowNegative:!1},t),this.each(function(){function n(){var e,t,n,a,r,o=g.get(0),i=0,s=0;return"number"==typeof o.selectionStart&&"number"==typeof o.selectionEnd?(i=o.selectionStart,s=o.selectionEnd):(t=document.selection.createRange())&&t.parentElement()===o&&(a=o.value.length,e=o.value.replace(/\r\n/g,"\n"),(n=o.createTextRange()).moveToBookmark(t.getBookmark()),(r=o.createTextRange()).collapse(!1),n.compareEndPoints("StartToEnd",r)>-1?i=s=a:(i=-n.moveStart("character",-a),i+=e.slice(0,i).split("\n").length-1,n.compareEndPoints("EndToEnd",r)>-1?s=a:(s=-n.moveEnd("character",-a),s+=e.slice(0,s).split("\n").length-1))),{start:i,end:s}}function a(e){var n="";return e.indexOf("-")>-1&&(e=e.replace("-",""),n="-"),n+t.prefix+e+t.suffix}function r(e){var n,r,o,i=e.indexOf("-")>-1&&t.allowNegative?"-":"",s=e.replace(/[^0-9]/g,""),l=s.slice(0,s.length-t.precision);return""===(l=(l=l.replace(/^0*/g,"")).replace(/\B(?=(\d{3})+(?!\d))/g,t.thousands))&&(l="0"),n=i+l,t.precision>0&&(r=s.slice(s.length-t.precision),o=new Array(t.precision+1-r.length).join(0),n+=t.decimal+o+r),a(n)}function o(e){var t,n,a=g.val().length;g.val(r(g.val())),t=g.val().length,n=e-=a-t,g.each(function(e,t){if(t.setSelectionRange)t.focus(),t.setSelectionRange(n,n);else if(t.createTextRange){var a=t.createTextRange();a.collapse(!0),a.moveEnd("character",n),a.moveStart("character",n),a.select()}})}function i(){var e=g.val();g.val(r(e))}function s(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function l(a){var r,i,l,c,u,v,d,f,p,h,m,w,b=(a=a||window.event).which||a.charCode||a.keyCode;return void 0!==b&&(48>b||b>57?45===b?(g.val((w=g.val(),t.allowNegative?""!==w&&"-"===w.charAt(0)?w.replace("-",""):"-"+w:w)),!1):43===b?(g.val(g.val().replace("-","")),!1):13===b||9===b||(!(!e.browser.mozilla||37!==b&&39!==b||0!==a.charCode)||(s(a),!0)):(v=!(g.val().length>=g.attr("maxlength")&&g.attr("maxlength")>=0),d=n(),f=d.start,p=d.end,h=!(d.start===d.end||!g.val().substring(f,p).match(/\d/)),m="0"===g.val().substring(0,1),!!(v||h||m)&&(s(a),r=String.fromCharCode(b),l=(i=n()).start,c=i.end,u=g.val(),g.val(u.substring(0,l)+r+u.substring(c,u.length)),o(l+1),!1)))}function c(){setTimeout(function(){i()},0)}function u(){return(parseFloat("0")/Math.pow(10,t.precision)).toFixed(t.precision).replace(new RegExp("\\.","g"),t.decimal)}var v,g=e(this);t=e.extend(t,g.data()),g.unbind(".maskMoney"),g.bind("keypress.maskMoney",l),g.bind("keydown.maskMoney",function(e){var a,r,i,l,c,u=(e=e||window.event).which||e.charCode||e.keyCode;return void 0!==u&&(r=(a=n()).start,i=a.end,8!==u&&46!==u&&63272!==u||(s(e),l=g.val(),r===i&&(8===u?""===t.suffix?r-=1:(c=l.split("").reverse().join("").search(/\d/),i=1+(r=l.length-c-1)):i+=1),g.val(l.substring(0,r)+l.substring(i,l.length)),o(r),!1))}),g.bind("blur.maskMoney",function(n){if(e.browser.msie&&l(n),""===g.val()||g.val()===a(u()))t.allowZero?t.affixesStay?g.val(a(u())):g.val(u()):g.val("");else if(!t.affixesStay){var r=g.val().replace(t.prefix,"").replace(t.suffix,"");g.val(r)}g.val()!==v&&g.change()}),g.bind("focus.maskMoney",function(){v=g.val(),i();var e,t=g.get(0);t.createTextRange&&((e=t.createTextRange()).collapse(!1),e.select())}),g.bind("click.maskMoney",function(){var e,t=g.get(0);t.setSelectionRange?(e=g.val().length,t.setSelectionRange(e,e)):g.val(g.val())}),g.bind("cut.maskMoney",c),g.bind("paste.maskMoney",c),g.bind("mask.maskMoney",i)})}};e.fn.maskMoney=function(n){return t[n]?t[n].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof n&&n?void e.error("Method "+n+" does not exist on jQuery.maskMoney"):t.init.apply(this,arguments)}}(window.jQuery||window.Zepto);