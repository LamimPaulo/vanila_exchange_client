<?php

$idioma = new \Utils\PropertiesUtils("perfil", IDIOMA);
$cliente = Utils\Geral::getCliente();
$mostrarBotoes = ($paridade->ativo > 0 && $paridade->statusMercado > 0 && $cliente->statusMercado > 0 && $paridade->moedaBook->statusMercado > 0 && $paridade->moedaBook->ativo > 0);
$mostrarAlerta = false;
$mensagemAlerta = "";

$idioma2 = new \Utils\PropertiesUtils("menu", IDIOMA);

$_data["idiomaMenu"] = $idioma;

?>

<style>
  .border-edit {
    border: 1px solid #1c84c6 !important;
  }

  .carregando {
    background: url("<?php echo IMAGES ?>loading.gif") center no-repeat;
    width: 200px;
    height: 200px;
    position: absolute;
    top: 30%;
    left: 45%;
    color: blue;
  }

  .box {
    border-radius: 10px !important;
  }

  .box-conversion-custom {
    padding-right: 3px !important;
    padding-left: 3px !important;
  }

  .row {
    margin-right: 0 !important;
    margin-left: 0 !important;
  }


  * {
    font-family: "Segoe UI", Roboto, sans-serif;
  }

  .choose-position .select2-container {
    width: 100% !important;
  }

  .choose-position .select2-container--default .select2-selection--single {
    width: 100% !important;
    display: flex;
    align-items: center;
    padding: 0 30px;
    height: 50px;
    line-height: 50px;
    font-weight: 500;
    font-size: 16px;
    background-color: #fafafa;
    border: 1px solid #eeeeee;
    border-radius: 25px;
    transition: 0.1s;
  }

  .select2-dropdown {
    border: 1px solid #eeeeee !important;
  }

  .choose-position .select2-search {
    display: none;
  }

  .choose-position .choose-input {
    width: 100% !important;
    display: flex;
    align-items: center;
    padding: 0 30px;
    height: 50px;
    line-height: 50px;
    font-weight: 500;
    font-size: 16px;
    background-color: #fafafa;
    border: 1px solid #eeeeee;
    border-top-left-radius: 25px;
    border-bottom-left-radius: 25px;
    border-top-right-radius: 4px;
    border-bottom-right-radius: 4px;
  }

  .choose-position .select2-results__option {
    display: flex;
    align-items: center;
  }

  .choose-position .select2-results__option .img-flag {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
    margin-right: 10px;
  }

  .choose-position .select2-container--default.select2-container--focus .select2-selection--single {
    border: 1px solid #c9c9c9 !important;
    outline: 0;
  }

  .choose-position span.select2-selection.select2-selection--single {
    outline: none;
  }

  .choose-position .select2-container--default .select2-selection--single .select2-selection__arrow {
    height: 35px;
    top: 50%;
    transform: translateY(-50%);
    right: 10px;
    width: 35px;
    background-color: #fff;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 5px 20px rgba(35, 49, 45, 0.14);
  }

  .btn-square {
    width: 75px;
    height: 75px;
    border-radius: 12px;
    border: 2px solid #2351ff;
    box-shadow: rgba(0, 0, 0, 0.2) 0px 2px 14px -6px;
  }

  .ico {
    transform: translate(13px, 62px);
  }

  .icon-badge {
    font-size: 20px;
  }

  .rounded-icon {
    height: 25px;
    width: 25px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    color: white;
    font-size: 1rem;
  }

  .fs-12 {
    font-size: 12px;
  }

  .fs-24 {
    font-size: 24px;
  }

  .settings .table {
    box-shadow: rgba(0, 0, 0, 0.2) 0px 2px 14px -6px;
    border-radius: 5px;
    border: none;
    margin-bottom: 15px;
  }

  .input_text {
    transform: translate(-10px, -37px);
  }

  .input_legend {
    background-color: white;
    transform: translate(10px, 16px);
    padding: 0 5px 0 5px;
    font-weight: bold;
    font-size: 12px;
  }

  .balance-hidden {
    display: none;
  }

  #loading_content {
    margin-top: 50vh;
  }

  #show_content {
    display: none;
  }
</style>
<?php Utils\Layout::append("inspina/metas", $_data) ?>
<?php Utils\Layout::append("inspina/scripts", $_data) ?>
<?php Utils\Layout::append("inspina/menu", $_data) ?>
<link href="<?php echo TEMA; ?>css.old/plugins/toastr/toastr.min.css" rel="stylesheet">
<!-- Main content -->

<div class="settings mtb15">
  <div class="container-fluid">
    <div class="row">
      <div class="col-12 col-md-11 mx-auto">
        <div id="show_content">
          <h4>Selecione uma moeda:</h4>
          <div class="row">
            <div class="col-md-6 mt-4">
              <div class="">
                <div class="row choose-position">
                  <div class="col box-conversion-custom">
                    <div class="form-group">
                      <select id="cryptoFrom"
                        class="crypto custom-select choose-position choose-position-input"></select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card">
                <div class="card-body">
                  <h4>Saldo de <span class="nome_moeda"></span></h4>
                  <div class="info_saldo">
                    <span>Saldo disponível:
                      <span class="balance-hidden">****</span>
                      <span class="saldo_disponivel fw-bold text-primary balance-visible"></span>
                    </span>
                    <a class="btn btn-sm btn-light ml-2" id="visibility-button3"><i class="icon ion-ios-eye"
                        id="eye3"></i></a>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <h4 class="mt-3">Staking de <span class="nome_moeda"></span></h4>
          <div class="row">
            <div class="col-md-6">
              <div class="card">
                <div class="card-body">
                  <!-- <h5 class="card-title"><?php echo $idioma2->getText("idioma") ?></h5> -->
                  <h5 class="fw-bold">Informações</h5>
                  <div class="mt-3">
                    <span>Recompensa líquida estimada:</span>
                    <span class="d-block"><b>3,30%</b> ao ano</span>
                  </div>
                  <div class="mt-3 d-flex">
                    <div class="">
                      <span>Resgate:</span>
                      <span class="d-block">Em até 5 dias úteis</span>
                    </div>
                    <div class="ml-5">
                      <span>Staking mínimo:</span>
                      <span class="d-block"><span class="min_stake"></span> <span class="symbol_moeda"></span></span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="card-body">
                  <h5 class="fw-bold">Em staking</h5>
                  <div class="row justify-content-between">
                    <div class="col-lg-5">
                      <div class="mt-3">
                        <span>Saldo total em staking:</span>
                        <span class="d-block"><span class="balance-hidden">****</span><span
                            class="staked_balance balance-visible"></span> <span class="symbol_moeda"></span></span>
                      </div>
                      <div class="mt-3">
                        <span>Lucro acumulado:</span>
                        <span class="d-block"><span class="balance-hidden">****</span><span
                            class="reward_amount balance-visible"></span> <span class="symbol_moeda"></span></span>
                      </div>
                      <div class="mt-3">
                        <span>Lucro total recebido:</span>
                        <span class="d-block"><span class="balance-hidden">****</span><span
                            class="accumulated_amount balance-visible"></span> <span class="symbol_moeda"></span></span>
                      </div>
                    </div>
                    <div class="col-lg-7 mt-3">
                      <div class="row">
                        <div class="col-6 mb-2">
                          <button
                            class="btn btn-light btn-square d-flex align-items-center mx-auto justify-content-center"
                            data-toggle="modal" data-target="#stakingModal">
                            <i class=""><img src="assets/img/icon/ico-staking.svg" alt="staking"></i>
                          </button>
                          <p class="fw-bold text-center">Fazer Staking</p>
                        </div>
                        <div class="col-6 mb-2">
                          <button
                            class="btn btn-light btn-square d-flex align-items-center mx-auto justify-content-center"
                            data-toggle="modal" data-target="#resgateModal">
                            <i class="ico"><img src="assets/img/icon/ico-resgatar.svg" alt="resgatar"></i>
                          </button>
                          <p class="fw-bold text-center">Resgatar</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="settings-main">
                <div class=" pl-2 pr-2 mr-2">
                  <p class="font-weight-lighter fs-12">ORIENTAÇÕES</p>
                  <div class="row">
                    <div class="col-1">
                      <span class="rounded-icon bg-primary">
                        <i class="icon ion-ios-information icon-badge"></i>
                      </span>
                    </div>
                    <div class="col-11">
                      As recompensas serão contabilizadas em até 2 dias úteis após
                      o Staking.
                    </div>
                  </div>

                  <p class="font-weight-lighter fs-12 mt-3">INFORMAÇÕES ADICIONAIS</p>
                  <div class="row">
                    <div class="col-1">
                      <span class="rounded-icon bg-primary">
                        <i class="icon ion-ios-information icon-badge"></i>
                      </span>
                    </div>
                    <div class="col-11">
                      <a href="#" data-toggle="modal" data-target="#infoModal">Clique aqui</a> e saiba como funciona o
                      Staking
                      de <span class="nome_moeda"></span>.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <h4 class="mt-5">Histórico</h4>
          <div class="row justify-content-end">
            <div class="col-lg-6 mt-3">
              <span class="d-block font-weight-lighter">ATIVIDADE</span>
              <div>
                <button class="btn btn-sm btn-primary mt-1">Todas</button>
                <button class="btn btn-sm btn-white mt-1">Staking</button>
                <button class="btn btn-sm btn-white mt-1">Recompensas</button>
                <button class="btn btn-sm btn-white mt-1">Resgate</button>
              </div>
            </div>
            <div class="col-lg-6 mt-3">
              <span class="d-block font-weight-lighter">STATUS</span>
              <div>
                <button class="btn btn-sm btn-primary mt-1">Todos</button>
                <button class="btn btn-sm btn-white mt-1">Finalizadas</button>
                <button class="btn btn-sm btn-white mt-1">Processando</button>
                <button class="btn btn-sm btn-white mt-1">Erro</button>
              </div>
            </div>
          </div>
          <table class="mt-4 table settings text-center" id="table-staking">
            <thead class="bg-light">
              <tr>
                <th scope="col">DATA</th>
                <th scope="col">ATIVIDADE</th>
                <th scope="col">QUANTIDADE</th>
                <th scope="col">PREVISÃO</th>
                <th scope="col">STATUS</th>
              </tr>
            </thead>
            <tbody class="align-middle border border-white">
              <tr>
                <th class="fs-12 align-middle p-2"><span>29/10/2023</span><span class="d-block">ÀS
                    13:32:51</span></th>
                <td class="align-middle">Recompensas</td>
                <td class="align-middle">0,00000226 ETH</td>
                <td class="align-middle">-</td>
                <td class="align-middle"><span class="badge bg-success p-2">Finalizado</span></td>
              </tr>
              <tr>
                <th class="fs-12 align-middle p-2"><span>28/10/2023</span><span class="d-block">ÀS
                    13:32:56</span></th>
                <td class="align-middle">Recompensas</td>
                <td class="align-middle">0,00000136 ETH</td>
                <td class="align-middle">-</td>
                <td class="align-middle"><span class="badge bg-success p-2">Finalizado</span></td>
              </tr>
              <tr>
                <th class="fs-12 align-middle p-2"><span>27/10/2023</span><span class="d-block">ÀS
                    13:32:31</span></th>
                <td class="align-middle">Recompensas</td>
                <td class="align-middle">0,00000165 ETH</td>
                <td class="align-middle">-</td>
                <td class="align-middle"><span class="badge bg-success p-2">Finalizado</span></td>
              </tr>
              <tr>
                <th class="fs-12 align-middle p-2"><span>26/10/2023</span><span class="d-block">ÀS
                    13:32:32</span></th>
                <td class="align-middle">Recompensas</td>
                <td class="align-middle">0,00000224 ETH</td>
                <td class="align-middle">-</td>
                <td class="align-middle"><span class="badge bg-success p-2">Finalizado</span></td>
              </tr>
              <tr>
                <th class="fs-12 align-middle p-2"><span>25/10/2023</span><span class="d-block">ÀS
                    18:32:1</span></th>
                <td class="align-middle">Recompensas</td>
                <td class="align-middle">0,00000184 ETH</td>
                <td class="align-middle">-</td>
                <td class="align-middle"><span class="badge bg-success p-2">Finalizado</span></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div id="loading_content" class="text-center">
          <div class="spinner-border text-primary" role="status" style="width: 5rem; height: 5rem;">
            <span class="sr-only">Loading...</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- stakeModal -->
<div class="modal fade" id="stakingModal" tabindex="-1" role="dialog" aria-labelledby="stakingModalTitle"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="stakingModalTitle">Staking de <span class="nome_moeda"></span> ( <span
            class="symbol_moeda"></span>)</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <div class="info_saldo d-flex">
              <a class="btn btn-sm btn-light ml-2" id="visibility-button"><i class="icon ion-ios-eye" id="eye"></i></a>
              <span class="mr-1">Disponível para stake:
                <a href="javascript:inserirSaldo(100);">
                  <span class="balance-hidden">****</span>
                  <span class="saldo_disponivel fw-bold text-primary balance-visible"><span
                      class="font-weight-lighter fs-10 text-success">Carregando Saldo</span></span>
                </a>
              </span>
            </div>
            <label for="stake_input" class="input_legend">Quantia para stake:</label>
            <input type="text" class="form-control input_height" id="stake_input" placeholder="1010.10564800">
            <div class="d-flex justify-content-between">
              <span class="fs-10 font-weight-lighter">Mínimo de 100 <span class="symbol_moeda"></span> para
                staking.</span>
              <span class="input_text symbol_moeda mt-2"></span>
            </div>
            <div class="d-flex justify-content-between mt-3">
              <a href="javascript:inserirSaldo(25);" class="btn btn-sm btn-outline-primary fw-bold">25%</a>
              <a href="javascript:inserirSaldo(50);" class="btn btn-sm btn-outline-primary fw-bold">50%</a>
              <a href="javascript:inserirSaldo(75);" class="btn btn-sm btn-outline-primary fw-bold">75%</a>
              <a href="javascript:inserirSaldo(100);" class="btn btn-sm btn-outline-primary fw-bold">100%</a>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer d-flex justify-content-between">
        <button type="button" class="btn btn-outline-danger" data-dismiss="modal">Cancelar</button>
        <a href="javascript:setStake();" type="button" class="btn btn-primary">Fazer Staking</a>
      </div>
    </div>
  </div>
</div>

<!-- resgateModal -->
<div class="modal fade" id="resgateModal" tabindex="-1" role="dialog" aria-labelledby="resgateModalTitle"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="resgateModalTitle">Resgate de <span class="nome_moeda"></span> ( <span
            class="symbol_moeda"></span>)</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <div class="info_saldo d-flex">
              <a class="btn btn-sm btn-light ml-2" id="visibility-button2"><i class="icon ion-ios-eye"
                  id="eye2"></i></a>
              <span class="mr-1">Disponível para resgate:
                <a href="javascript:inserirSaldoStake(100);">
                  <span class="balance-hidden">****</span>
                  <span class="staked_balance fw-bold text-primary balance-visible"><span
                      class="font-weight-lighter fs-10">Carregando Saldo</span></span>
                </a>
              </span>
            </div>
            <label for="resgate_input" class="input_legend">Quantia para resgate:</label>
            <input type="text" class="form-control input_height" id="resgate_input" placeholder="1010.10564800">
            <div class="d-flex justify-content-between">
              <span class="fs-10 font-weight-lighter">Informe o valor de <span class="symbol_moeda"></span> para
                resgate.</span>
              <span class="input_text symbol_moeda mt-2"></span>
            </div>
            <div class="d-flex justify-content-between mt-3">
              <a href="javascript:inserirSaldoStake(25);" class="btn btn-sm btn-outline-primary fw-bold">25%</a>
              <a href="javascript:inserirSaldoStake(50);" class="btn btn-sm btn-outline-primary fw-bold">50%</a>
              <a href="javascript:inserirSaldoStake(75);" class="btn btn-sm btn-outline-primary fw-bold">75%</a>
              <a href="javascript:inserirSaldoStake(100);" class="btn btn-sm btn-outline-primary fw-bold">100%</a>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer d-flex justify-content-between">
        <button type="button" class="btn btn-outline-danger" data-dismiss="modal">Cancelar</button>
        <a href="javascript:setStake();" type="button" class="btn btn-primary">Fazer Resgate</a>
      </div>
    </div>
  </div>
</div>

<!-- infoModal -->
<div class="modal fade" id="infoModal" tabindex="-1" role="dialog" aria-labelledby="infoModalTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="infoModalTitle">Informações do staking de <span class="symbol_moeda"></span></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p class="font-weight-lighter fs-12">ORIENTAÇÕES</p>
        <div class="row">
          <div class="col-1">
            <span class="rounded-icon bg-primary">
              <i class="icon ion-ios-information icon-badge"></i>
            </span>
          </div>
          <div class="col-11">
            <span>As recompensas serão contabilizadas em até 2 dias úteis após o Staking.</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>

<!-- noCoinsModal -->
<div class="modal fade" id="noCoinsModal" tabindex="-1" role="dialog" aria-labelledby="noCoinsModalTitle"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="noCoinsModalTitle">OPS! Não existem moedas na sua carteira</h5>
        <!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button> -->
      </div>
      <div class="modal-body">
        <p class="text-center">Faça primeiro um depósito em sua carteira, use o botão abaixo!</p>
        <a class="btn btn-light btn-square d-flex align-items-center mx-auto justify-content-center" href="/deposit">
          <i class="text-primary fs-30"><img src="assets/img/icon/ico-depositar.svg" alt="deposit"></i>
        </a>
        <p class="fw-bold text-center">Depositar</p>
      </div>
      <div class="modal-footer">
        <a type="button" class="btn btn-secondary" href="/portfolio">Ir para o Dashboard</a>
      </div>
    </div>
  </div>
</div>

<!-- End Main content -->

<?php Utils\Layout::append("inspina/footer_esp", $_data) ?>
<link href="<?php echo TEMA; ?>css.old/plugins/toastr/toastr.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
  integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
  integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="<?php echo JS; ?>maskMoney.min.js"></script>
<script>
  window.addEventListener('load', () => {
    const staking_table = document.querySelector('#table-staking');
    staking_table.classList.toggle('table-responsive', window.matchMedia('(max-width:505px)').matches);
  });
</script>
<script>
  window.addEventListener('resize', () => {
    const staking_table = document.querySelector('#table-staking');
    staking_table.classList.toggle('table-responsive', window.matchMedia('(max-width:505px)').matches);
  });
</script>
<script>
  var preco = 0;
  var time = 0;
  var saldo = 0;
  var saldo_stake = 0;
  var regressor = null;
  let balanceVisibility = "";
  
  var tokens = [];
  
  const handleVisibility = () => {
    const eye = document.getElementById("eye");
    const eye2 = document.getElementById("eye2");
    const eye3 = document.getElementById("eye3");
    if (balanceVisibility == "true") {
      const hidden = document.querySelectorAll(".balance-hidden");
      for (var i = 0; i < hidden.length; i++) {
        hidden[i].style.display = "inline-flex";
      }
      const visible = document.querySelectorAll(".balance-visible");
      for (var i = 0; i < visible.length; i++) {
        visible[i].style.display = "none";
      }
      eye.classList.remove("ion-ios-eye");
      eye.classList.add("ion-ios-eye-off");
      eye2.classList.remove("ion-ios-eye");
      eye2.classList.add("ion-ios-eye-off");
      eye3.classList.remove("ion-ios-eye");
      eye3.classList.add("ion-ios-eye-off");
      balanceVisibility = "false";
      localStorage.setItem("balance_visibility", "false")
    } else {
      const hidden = document.querySelectorAll(".balance-hidden");
      for (var i = 0; i < hidden.length; i++) {
        hidden[i].style.display = "none";
      }
      const visible = document.querySelectorAll(".balance-visible");
      for (var i = 0; i < visible.length; i++) {
        visible[i].style.display = "inline-flex";
      }
      eye.classList.remove("ion-ios-eye-off");
      eye.classList.add("ion-ios-eye");
      eye2.classList.remove("ion-ios-eye-off");
      eye2.classList.add("ion-ios-eye");
      eye3.classList.remove("ion-ios-eye-off");
      eye3.classList.add("ion-ios-eye");
      balanceVisibility = "true";
      localStorage.setItem("balance_visibility", "true")
    }
  }

  if(balanceVisibility == "" && !localStorage.getItem("balance_visibility")){
    balanceVisibility = "true";
    handleVisibility()
  } else{
    localStorage.getItem("balance_visibility") == "true" ? balanceVisibility = "false" : balanceVisibility = "true";
    handleVisibility()
  }

  document.getElementById("visibility-button").addEventListener("click", handleVisibility);
  document.getElementById("visibility-button2").addEventListener("click", handleVisibility);
  document.getElementById("visibility-button3").addEventListener("click", handleVisibility);

  $(document).ready(function () {

    $("#cryptoFrom").select2();

    $("#cryptoFrom").on('select2:select', function (e) {
      $(".saldo_disponivel").html("");
      saldo = 0;
      var data = $("#cryptoFrom").val();
      carregarSaldo(data);
    });

    var option = '';
    $.ajax({
      url: "<?php echo URLBASE_CLIENT . \Utils\Rotas::R_STAKING_BALANCE ?>",
      method: "POST",
      dataType: 'json',
      success: function (json) {

        if (json.sucesso && json.moedas.length) {
          tokens = json.moedas;
          json.moedas.forEach(element => {
            option += '<option value="' + element.id_moeda + '" title="' + element.imagem + '" data-decimal="' + element.decimal + '">' + element.simbolo + ' - ' + element.nome + '</option>';
          });
          $('#cryptoFrom').html(option);
          const nome = $("#cryptoFrom option:selected").text().replace(" ", "").split("-");
          const token = json.moedas.filter(t => t.simbolo === nome[0])
          $('.nome_moeda').html(nome[1]);
          $('.symbol_moeda').html(nome[0]);
          $('.min_stake').html(fixDecimals(token[0].min_stake, token[0].decimal));
          saldo = token[0].saldo_disponivel;
          saldo_stake = token[0].staked_balance;
          $('.staked_balance').html(fixDecimals(token[0].staked_balance, token[0].decimal));
          $('.accumulated_amount').html(fixDecimals(token[0].accumulated_amount, token[0].decimal));
          $('.reward_amount').html(fixDecimals(token[0].reward_amount, token[0].decimal));
          $(".saldo_disponivel").html(fixDecimals(token[0].saldo_disponivel, token[0].decimal));
          $(".crypto").select2({
            templateResult: function (coin) {
              var $span = $("<span><img style='width: 25px;' src=" + coin.title + " /> " + coin.text + "</span>");
              return $span;
            },
            templateSelection: function (coin) {
              var $span = $("<span><img style='width: 25px;' src=" + coin.title + " /> " + coin.text + "</span>");
              return $span;
            }
          });

          carregarSaldo($("#cryptoFrom").val());
        } else {
          $("#noCoinsModal").modal("show");
          showNotyAlert("Sem moedas na carteira, primeiro adquira moedas!", "e");
        }
      }
    });
  });

  function fixDecimals(num, decimal) {
    return (parseFloat(num).toFixed(decimal)).toString().replace('.', ',')
  }

  function setStake() {
    var valor = $('#stake_input').val();
    valor = parseFloat(valor.replace(',', '.'))
    try {
      if (valor <= saldo * 1) {
        $.ajax(
          {
            url: "<?php echo URLBASE_CLIENT . \Utils\Rotas::R_STAKING_STAKE ?>",
            method: "POST",
            dataType: 'json',
            data: {
              coin_id: 1, //TODO
              amount: valor,
            },
            success: function (json) {
              if (json.sucesso) {
                console.log("stake res: ", json)

                showNotyAlert("Certo!", "s");


              }
            }
          },
        );


      } else {
        showNotyAlert("Errado!", "e");
      }
    } catch (e) {
      showNotyAlert(e, "e");
    }
  }

  function setResgate() {
    var valor = $('#resgate_input').val();
    valor = parseFloat(valor.replace(',', '.'))
    try {
      if (valor <= saldo_stake * 1 && valor > 0) {
        // showNotyAlert("Certo!", "s");
        $.ajax(
          {
            url: "<?php echo URLBASE_CLIENT . \Utils\Rotas::R_STAKING_UNSTAKE ?>",
            method: "POST",
            dataType: 'json',
            data: {
              coin_id: 1, //TODO
              amount: valor,
            },
            success: function (json) {
              if (json.sucesso) {
                console.log("stake res: ", json)

                showNotyAlert("Certo!", "s");


              }
            }
          },
        );


      } else {
        showNotyAlert("Errado!", "e");
      }
    } catch (e) {
      showNotyAlert(e, "e");
    }
  }

  function inserirSaldo(percent) {
    var saldo_inserido = (saldo * percent / 100);
    $('#stake_input').val(saldo_inserido.toString().replace('.', ','));
    // $('#valor').maskMoney('mask', saldo_inserido);
  };

  function inserirSaldoStake(percent) {
    var saldo_resgate = (saldo_stake * percent / 100);
    $('#resgate_input').val(saldo_resgate.toString().replace(".", ","));
  };

  function carregarSaldo(moeda) {
    $('#nome_moeda').html("");
    document.getElementById("loading_content").style.display = "none";
    document.getElementById("show_content").style.display = "block";
    // $.ajax({
    //   url: "<?php echo URLBASE_CLIENT . \Utils\Rotas::R_STAKING_BALANCE ?>",
    //   method: "POST",
    //   dataType: 'json',
    //   data: {
    //     moeda: moeda
    //   },
    //   success: function (json) {
    //     if (json.sucesso) {
    //       document.getElementById("loading_content").style.display = "none";
    //       document.getElementById("show_content").style.display = "block";

    const nome = $("#cryptoFrom option:selected").text().replace(" ", "").split("-");
    const token = tokens.filter(t => t.simbolo === nome[0])
    $('.nome_moeda').html(nome[1]);
    $('.symbol_moeda').html(nome[0]);
    $('.min_stake').html(fixDecimals(token[0].min_stake, token[0].decimal));
    saldo = token[0].saldo_disponivel;
    saldo_stake = token[0].staked_balance;
    $('.staked_balance').html(fixDecimals(token[0].staked_balance, token[0].decimal));
    $('.accumulated_amount').html(fixDecimals(token[0].accumulated_amount, token[0].decimal));
    $('.reward_amount').html(fixDecimals(token[0].reward_amount, token[0].decimal));
    $(".saldo_disponivel").html(fixDecimals(token[0].saldo_disponivel, token[0].decimal));
    $("#stake_input").val("");
    $("#resgate_input").val("");
    $(".crypto").select2({
      templateResult: function (coin) {
        var $span = $("<span><img style='width: 25px;' src=" + coin.title + " /> " + coin.text + "</span>");
        return $span;
      },
      templateSelection: function (coin) {
        var $span = $("<span><img style='width: 25px;' src=" + coin.title + " /> " + coin.text + "</span>");
        return $span;
      }
      // });
      //   }
      // }
    });
  }

</script>

<?php Utils\Layout::append("mensage_text", $_data) ?>